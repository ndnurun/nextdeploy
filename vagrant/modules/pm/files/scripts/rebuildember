#!/bin/bash

# if we are root, exit
(( $UID == 0 )) && echo "please execute with modem user, not root" && exit 1

if [[ ! -f /ror/public/index.html ]] ||
[[ -n "$(find /ror/webui/app/. -type f -mmin -1)" ]] ||
[[ -n "$(find /ror/webui/config/. -type f -mmin -1)" ]] ||
[[ -n "$(find /ror/webui/public/. -type f -mmin -1)" ]] ||
[[ -n "$(find /ror/webui/package.json -type f -mmin -1)" ]] ||
[[ -n "$(find /ror/webui/bower.json -type f -mmin -1)" ]]; then
  pushd /ror/webui > /dev/null
  npm install
  bower install
  ember build --environment %%RAILSENV%% --output-path /ror/public/
  popd > /dev/null
fi